var yk_mt_entry_id=0,yk_mt_selected_meal_type=!1,yk_mt_meal_tracker_found="undefined"!=typeof yk_mt_sc_meal_tracker,yk_meal_tracker_dialog=!1,yk_meal_tracker_dialog_mode="add",yk_mt_meal_selector=!1,yk_mt_meal_tracker_show=yk_mt_meal_tracker_found&&"default"===yk_mt_sc_meal_tracker.mode;function yk_mt_trigger_meal_entry_delete(e){jQuery("body").trigger("meal-tracker-meal-entry-delete",[e])}jQuery(document).ready(function(e){function t(){e(".yk-mt__accordion .yk-mt__accordion-section-title").removeClass("active"),e(".yk-mt__accordion .yk-mt__accordion-section-content").slideUp(300).removeClass("open")}if(!0===yk_mt_meal_tracker_found&&(yk_mt_entry_id=yk_mt_sc_meal_tracker["todays-entry"].id),yk_mt_meal_tracker_found&&"true"===yk_mt_sc_meal_tracker["accordion-enabled"]&&(t(),e(".yk-mt__accordion-section .initial-active").each(function(){var t=e(this).attr("href");e(this).addClass("active"),e(".yk-mt__accordion "+t).slideDown(300).addClass("open")}),e(".yk-mt__accordion-section-title").click(function(a){var l=e(this).attr("href");e(a.target).is(".active")?t():(t(),e(this).addClass("active"),e(".yk-mt__accordion "+l).slideDown(300).addClass("open")),a.preventDefault()})),e(".yk-mt-add-meal-prompt").click(function(t){let a=e(t.target).data("meal-type");yk_mt_selected_meal_type=a,e("body").attr("yk-mt-meal-type",a)}),!0===yk_mt_meal_tracker_show){var a=JSON.parse(yk_mt_sc_meal_tracker["dialog-options"]);a.afterClose=function(){yk_meal_tracker_dialog_mode="add",e("body").removeClass("yk-mt-dialog-is-open"),e("body").trigger("meal-tracker-dialog-closing"),yk_mt_selected_meal_type=!1,function(){if(!1!==yk_mt_meal_selector){var e=yk_mt_meal_selector[0].selectize;e.clear()}}(),e("#yk-mt-add-meal-dialog").removeClass("yk-mt-mode-edit"),e("#yk-mt-add-meal-dialog").addClass("yk-mt-mode-add"),e("#yk-mt-form-add-new-meal").trigger("reset"),e(".yk-mt-hide-if-no-meals-results").hide(),e("body").trigger("meal-tracker-dialog-closed")},a.beforeOpen=function(){yk_mt_meal_selector=e("#yk-mt-meal-id").selectize({preload:!0,valueField:"id",labelField:"name",searchField:"name",options:[],load:function(t,a){this.clearOptions(),e.ajax({url:yk_mt["ajax-url"],type:"POST",data:{action:"meals",security:yk_mt["ajax-security-nonce"],search:t},error:function(){a()},success:function(t){!1===t&&e(".yk-mt-hide-if-no-meals-results").fadeOut("slow"),a(t)}})},onChange:function(t){""!==t?e(".yk-mt-hide-if-no-meals-results").fadeIn("slow"):e(".yk-mt-hide-if-no-meals-results").fadeOut("slow")}}),e("#yk-mt-add-meal-dialog").removeClass("yk-mt-mode-edit yk-mt-mode-add"),e("#yk-mt-add-meal-dialog").addClass("yk-mt-mode-"+yk_meal_tracker_dialog_mode),e("body").addClass("yk-mt-dialog-is-open"),e("#yk-mt-add-meal-dialog").removeClass("yk-mt-hide"),c()},yk_meal_tracker_dialog=e(".yk-mt-add-meal-prompt, .yk-mt-edit-meal-prompt").animatedModal(a)}function l(e){if(!1!==yk_mt_meal_selector&&e){var t=yk_mt_meal_selector[0].selectize;t.addOption(e),t.addItem(e.id)}}function r(t,a,l){a.action=t,a.security=yk_mt["ajax-security-nonce"],e("body").trigger("meal-tracker-ajax-started"),jQuery.post(yk_mt["ajax-url"],a,function(t){l(a,t),e("body").trigger("meal-tracker-ajax-finished")})}function n(t,a){!1===a.error?(w(a.entry),e("#yk-mt-form-add-meal-to-entry").trigger("reset"),C(yk_mt_sc_meal_tracker.localise["meal-entry-added-success"]),C(yk_mt_sc_meal_tracker.localise["meal-entry-added-short"],"#yk-mt-button-add-meal-"+t.quantity),e("#yk-mt-button-add-meal-close").is(":checked")&&e("#btn-close-modal").click(),e("body").trigger("meal-tracker-meal-added")):(e("#btn-close-modal").click(),e("body").trigger("meal-tracker-save-error"))}function m(t,a){!1===a.error?(w(a.entry),C(yk_mt_sc_meal_tracker.localise["meal-entry-deleted-success"]),e("body").trigger("meal-tracker-meal-deleted")):e("body").trigger("meal-tracker-save-error")}function o(){r("get_entry",{"entry-id":yk_mt_entry_id},i)}function i(e,t){w(t)}function d(t,a){!1===a.error?(l(a["new-meal"]),C(yk_mt_sc_meal_tracker.localise["meal-entry-added-short"],"#yk-mt-button-meal-add"),e("#yk-mt-form-add-new-meal").trigger("reset"),C(yk_mt_sc_meal_tracker.localise["meal-entry-added-success"]),o(),e("#btn-close-modal").click(),e("body").trigger("meal-tracker-new-meal-added")):e("body").trigger("meal-tracker-save-error")}function c(){let t=e("#yk-mt-add-meal-unit").val(),a=e("#yk-mt-add-meal-quantity-row");var l;!0==(l=t,-1!==e.inArray(l,yk_mt["units-hide-quantity"]))?(e("#yk-mt-add-meal-quantity").prop("disabled",!0),e("#yk-mt-add-meal-quantity").prop("required",!1),e("#yk-mt-add-meal-quantity").val(""),a.hide()):(e("#yk-mt-add-meal-quantity").prop("disabled",!1),e("#yk-mt-add-meal-quantity").prop("required",!0),a.show())}function s(t,a){if(!1===a.error){let t=a.meal;e("#yk-mt-add-meal-name").val(t.name),e("#yk-mt-add-meal-description").val(t.description),e("#yk-mt-add-meal-calories").val(t.calories),e("#yk-mt-add-meal-unit").val(t.unit),e("#yk-mt-add-meal-quantity").val(t.quantity);let l=g();!1!==l&&e.each(l,function(a,l){e("#yk-mt-add-meal-"+a).val(t[a])}),y("manual"),function(t="edit"){c(),yk_meal_tracker_dialog_mode=t,"edit"===t&&e("#yk-mt-open-dialog-edit").click()}()}else e("body").trigger("meal-tracker-loading-error")}function _(t,a){!1===a.error?(C(yk_mt_sc_meal_tracker.localise["meal-entry-added-success"]),o(),e("#btn-close-modal").click(),e("body").trigger("meal-tracker-meal-updated")):(e("#btn-close-modal").click(),e("body").trigger("meal-tracker-save-error"))}function y(t){switch(t){case"manual":e("#yk-mt-form-add-new-meal-nav").hide(),e(".yk-mt__modal-quick-search").hide(),e(".yk-mt-add-new-meal-form").fadeIn("slow");break;case"search":e("#yk-mt-form-add-new-meal-nav").hide(),e(".yk-mt__modal-quick-search").hide(),e(".yk-mt-add-new-meal-form-search-external").fadeIn("slow"),e("#yk-mt-search-external").selectize({preload:!1,valueField:"id",labelField:"name",searchField:"name",options:[],render:{option:function(e,t){let a='<div class="external_list_item">';return a+="<h6>",e.ext_image&&(a=a+'<img src="'+t(e.ext_image)+'" width="96" align="left"/>'),a=(a=(a=a+t(e.name)+"</h6>")+'<p class="description">'+t(e.description)+"</p>")+'<p class="nutrition">'+t(e.nutrition)+"</p>",a+="<div>"}},load:function(t,a){""!=t&&(this.clearOptions(),e.ajax({url:yk_mt["ajax-url"],type:"POST",data:{action:"external_search",security:yk_mt["ajax-security-nonce"],search:t},error:function(){a()},success:function(t){"error"==t?(j(yk_mt_sc_meal_tracker.localise["search-error"]),e(".yk-mt-button-external-add-and-close, .yk-mt-button-external-add").fadeOut("slow")):!1===t||0==t?(function(e,t=null){O(e,"info",t)}(yk_mt_sc_meal_tracker.localise["search-no-results"]),e(".yk-mt-button-external-add-and-close, .yk-mt-button-external-add").fadeOut("slow")):e(".yk-mt-button-external-add-and-close, .yk-mt-button-external-add").fadeIn("slow"),a(t)}}))}});break;default:k()}}function k(){e(".yk-mt-add-new-meal-form").hide(),e(".yk-mt-add-new-meal-form-search-external").hide(),e("#yk-mt-form-add-new-meal-nav").fadeIn("slow"),e(".yk-mt__modal-quick-search").fadeIn("slow")}function u(e,t){if(!1===t.error){C(yk_mt_sc_meal_tracker.localise["search-added"]),l({id:t.meal_id,name:e.name}),!0===e.close&&k()}else j(yk_mt_sc_meal_tracker.localise["db-error"])}function f(t,a){!1===a.error?(C(yk_mt_sc_meal_tracker.localise["settings-saved-success"]),setTimeout(function(){window.location.replace(yk_mt["page-url"])},600)):e("body").trigger("meal-tracker-save-error")}function p(){"own"===e("#yk-mt-calorie-source").val()?(e("#yk-mt-allowed-calories").prop("required",!0),e("#yk-mt-allowed-calories-row").show(200)):(e("#yk-mt-allowed-calories").prop("required",!1),e("#yk-mt-allowed-calories-row").hide(200))}function g(){return!1!==yk_mt_meal_tracker_found&&(void 0!==yk_mt_sc_meal_tracker["meta-fields"]&&yk_mt_sc_meal_tracker["meta-fields"])}function v(t){return e("#yk-mt-shortcode-meal-tracker").attr("yk-mt-"+t)}e(".yk-mt-meal-button-add").click(function(t){t.preventDefault();var a=e(this).data("quantity");!function(e,t,a,l=1){if(t){l||(l=1);var m={"entry-id":e,"meal-id":t,"meal-type":a,quantity:l};r("add_meal_to_entry",m,n)}else j(yk_mt_sc_meal_tracker.localise["meal-entry-missing-meal"],"#yk-mt-form-add-meal-to-entry .selectize-control")}(yk_mt_entry_id,e("#yk-mt-meal-id").val(),yk_mt_selected_meal_type,a)}),e("body").on("meal-tracker-save-error",function(e){j(yk_mt_sc_meal_tracker.localise["db-error"])}),e("body").on("meal-tracker-loading-error",function(e){j(yk_mt_sc_meal_tracker.localise["db-error-loading"])}),e("body").on("meal-tracker-meal-entry-delete",function(e,t){!function(e){r("delete_meal_from_entry",{"meal-entry-id":e,"entry-id":yk_mt_entry_id},m)}(t)}),e("#yk-mt-form-add-new-meal").submit(function(t){t.preventDefault();let a=e("#yk-mt-add-meal-name").val(),l=e("#yk-mt-add-meal-description").val(),n=e("#yk-mt-add-meal-calories").val(),m=e("#yk-mt-add-meal-quantity").val(),o=e("#yk-mt-add-meal-unit").val(),i=g();yk_mt_meal_tracker_found&&!1!==i&&e.each(i,function(t,a){i[t]=e("#yk-mt-add-meal-"+t).val()}),"edit"===yk_meal_tracker_dialog_mode?function(e,t,a,l,n,m){r("add_meal",{id:v("meal-id"),name:e,description:t,calories:a,quantity:l,unit:n,"entry-id":yk_mt_entry_id,"meal-type":yk_mt_selected_meal_type,"meta-fields":m},_)}(a,l,n,m,o,i):function(e,t,a,l,n,m){r("add_meal",{name:e,description:t,calories:a,quantity:l,unit:n,"entry-id":yk_mt_entry_id,"meal-type":yk_mt_selected_meal_type,"meta-fields":m},d)}(a,l,n,m,o,i)}),e("#yk-mt-add-meal-unit").change(function(){c()}),e("body").on("click",".yk-mt-meal-button-edit-inline",function(t){t.preventDefault();let a=e(this).attr("data-meal-id");var l,n;l="meal-id",n=a,e("#yk-mt-shortcode-meal-tracker").attr("yk-mt-"+l,n),r("meal",{"meal-id":v("meal-id")},s)}),e("body").on("meal-tracker-dialog-closing",function(e){k()}),e("#yk-mt-button-meal-nav-manually-add").click(function(e){e.preventDefault(),y("manual")}),e("#yk-mt-button-meal-nav-search").click(function(e){e.preventDefault(),y("search")}),e(".yk-mt-button-reset-meal-nav").click(function(e){e.preventDefault(),k()}),e(".yk-mt-button-external-add").click(function(t){t.preventDefault();let a=e("#yk-mt-search-external")[0].selectize,l=a.getValue();if(""===l)return;let n="yk-mt-button-external-meal-add-close"===e(this).attr("id");r("external_add_to_collection",{meal_id:l,name:a.getItem(a.getValue())[0].innerHTML,close:n},u)}),e("#yk-mt-settings-form").submit(function(t){t.preventDefault();let a={};e("#yk-mt-settings-form input[type=number], #yk-mt-settings-form select").each(function(){a[e(this).attr("id")]=e(this).val()}),r("save_settings",a,f)}),e("#yk-mt-calorie-source").change(function(){p()}),p(),e(".yk-mt-clickable").click(function(t){t.preventDefault();let a=e(this).attr("href");window.location.replace(a)});const h=({meal_entry_id:e,meal_type:t,name:a,calories:l,quantity:r,d:n,id:m})=>`\n                        <div class="yk-mt__table-row" data-mt="${t}">\n                            <div class="yk-mt__table-cell yk-mt__table-cell-meal">\n                                <span class="yk-mt__meal-name">${a}</span>\n                            </div>\n                            <div class="yk-mt__table-cell yk-mt__table-cell-quantity yk-mt-cq">\n                                <span class="yk-mt__meal-data">${n}</span>\n                            </div>\n                            <div class="yk-mt__table-cell yk-mt__table-cell-controls yk-mt-o">\n                                <div class="yk-mt__btn-group yk-mt-inline-flex">\n                                    <button data-meal-id="${m}" class="yk-mt-act-r yk-mt-act-r--edit yk-mt-hide-if-not-pro yk-mt-meal-button-edit-inline" >\n                                        <span class="fa fa-edit"></span>\n                                        <span class="yk-mt-r__text">${yk_mt_sc_meal_tracker.localise["edit-text"]}</span>\n                                    </button>\n                                    <button data-id="${e}" class="yk-mt-act-r yk-mt-act-r--remove" onclick="yk_mt_trigger_meal_entry_delete( ${e} )">\n                                        <span class="fa fa-close"></span>\n                                        <span class="yk-mt-r__text">${yk_mt_sc_meal_tracker.localise["remove-text"]}</span>\n                                    </button>\n                                </div>\n                            </div>\n                        </div>`,b=({total:e,unit:t})=>`\n                        <div class="yk-mt__table-row yk-mt__table-row-totals">\n                                <div class="yk-mt__table-cell yk-mt__table-cell-total-text">Total:</div>\n                                <div class="yk-mt__table-cell yk-mt__table-cell-total yk-mt-cq">\n                                    ${e}${t}\n                                </div>\n                                <div class="yk-mt__table-cell yk-mt-o">\n                                </div>\n                        </div>`;function w(t){"object"==typeof t&&(x(),e.each(t.meals,function(a,l){!function(t,a,l){let r='<p class="yk-mt__no-meals">'+yk_mt_sc_meal_tracker.localise["no-data"]+".</p>";0!==a.length&&(html_meals=a.map(h).join(""),l=[{total:l,unit:yk_mt_sc_meal_tracker.localise["calorie-unit"]}],html_total=l.map(b).join(""),r=html_meals+html_total),e("#meals-table-"+t).html(r)}(a,l,t.counts[a])}),yk_mt_chart_data_set(t.calories_allowed,t.calories_remaining,t.calories_used,t.percentage_used,t.chart_title),yk_mt_chart_render(),q())}function x(){e.LoadingOverlay("show"),setTimeout(function(){q()},3e3)}function q(){e.LoadingOverlay("hide")}function j(e,t=null){O(e,"error",t)}function C(e,t=null){O(e,"success",t)}function O(t,a="warn",l=null){let r={position:"bottom right",className:a};null===l?e.notify(t,r):e(l).notify(t,r)}!0===yk_mt_meal_tracker_show&&yk_mt_sc_meal_tracker["load-entry"]&&w(yk_mt_sc_meal_tracker["todays-entry"]),e("body").on("meal-tracker-ajax-started",function(e){x()}),e("body").on("meal-tracker-ajax-finished",function(e){q()})});
