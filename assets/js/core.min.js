var yk_mt_entry_id=0,yk_mt_selected_meal_type=!1,yk_mt_meal_tracker_found="undefined"!=typeof yk_mt_sc_meal_tracker,yk_meal_tracker_dialog=!1,yk_meal_tracker_dialog_mode="add",yk_mt_meal_selector=!1,yk_mt_meal_tracker_show=yk_mt_meal_tracker_found&&"default"===yk_mt_sc_meal_tracker.mode;jQuery(document).ready(function(a){function b(){a(".yk-mt__accordion .yk-mt__accordion-section-title").removeClass("active"),a(".yk-mt__accordion .yk-mt__accordion-section-content").slideUp(300).removeClass("open")}function c(){yk_meal_tracker_dialog_mode="add",f(),a("#yk-mt-add-meal-dialog").removeClass("yk-mt-mode-edit"),a("#yk-mt-add-meal-dialog").addClass("yk-mt-mode-add"),a("#yk-mt-form-add-new-meal").trigger("reset")}function d(b="edit"){r(),yk_meal_tracker_dialog_mode=b,"edit"===b&&a("#yk-mt-open-dialog-edit").click()}function e(){a("#yk-mt-add-meal-dialog").removeClass("yk-mt-mode-edit yk-mt-mode-add"),a("#yk-mt-add-meal-dialog").addClass("yk-mt-mode-"+yk_meal_tracker_dialog_mode)}function f(){yk_mt_selected_meal_type=!1}function g(a){if(!1!==yk_mt_meal_selector&&a){var b=yk_mt_meal_selector[0].selectize;b.addOption(a),b.addItem(a.id)}}function h(){yk_mt_meal_selector=a("#yk-mt-meal-id").selectize({preload:!0,valueField:"id",labelField:"name",searchField:"name",options:[],load:function(b,c){this.clearOptions(),a.ajax({url:yk_mt["ajax-url"],type:"POST",data:{action:"meals",security:yk_mt["ajax-security-nonce"],search:b},error:function(){c()},success:function(a){c(a)}})}})}function i(b,c,d){c.action=b,c.security=yk_mt["ajax-security-nonce"],a("body").trigger("meal-tracker-ajax-started"),jQuery.post(yk_mt["ajax-url"],c,function(b){d(c,b),a("body").trigger("meal-tracker-ajax-finished")})}function j(a,b,c,d=1){if(b){d||(d=1);var e={"entry-id":a,"meal-id":b,"meal-type":c,quantity:d};i("add_meal_to_entry",e,k)}else F(yk_mt_sc_meal_tracker.localise["meal-entry-missing-meal"],"#yk-mt-form-add-meal-to-entry .selectize-control")}function k(b,c){!1===c.error?(C(c.entry),a("#yk-mt-form-add-meal-to-entry").trigger("reset"),G(yk_mt_sc_meal_tracker.localise["meal-entry-added-success"]),G(yk_mt_sc_meal_tracker.localise["meal-entry-added-short"],"#yk-mt-button-add-meal-"+b.quantity),a("#yk-mt-button-add-meal-close").is(":checked")&&a("#btn-close-modal").click(),a("body").trigger("meal-tracker-meal-added")):(a("#btn-close-modal").click(),a("body").trigger("meal-tracker-save-error"))}function l(a){var b={"meal-entry-id":a,"entry-id":yk_mt_entry_id};i("delete_meal_from_entry",b,m)}function m(b,c){!1===c.error?(C(c.entry),G(yk_mt_sc_meal_tracker.localise["meal-entry-deleted-success"]),a("body").trigger("meal-tracker-meal-deleted")):a("body").trigger("meal-tracker-save-error")}function n(){var a={"entry-id":yk_mt_entry_id};i("get_entry",a,o)}function o(a,b){C(b)}function p(a,b,c,d,e){var f={name:a,description:b,calories:c,quantity:d,unit:e,"entry-id":yk_mt_entry_id,"meal-type":yk_mt_selected_meal_type};i("add_meal",f,q)}function q(b,c){!1===c.error?(g(c["new-meal"]),G(yk_mt_sc_meal_tracker.localise["meal-entry-added-short"],"#yk-mt-button-meal-add"),a("#yk-mt-form-add-new-meal").trigger("reset"),G(yk_mt_sc_meal_tracker.localise["meal-entry-added-success"]),n(),a("#btn-close-modal").click(),a("body").trigger("meal-tracker-new-meal-added")):a("body").trigger("meal-tracker-save-error")}function r(){let b=a("#yk-mt-add-meal-unit").val(),c=a("#yk-mt-add-meal-quantity-row");!0===A(b)?(a("#yk-mt-add-meal-quantity").prop("disabled",!0),a("#yk-mt-add-meal-quantity").val("")):a("#yk-mt-add-meal-quantity").prop("disabled",!1)}function s(){i("meal",{"meal-id":z("meal-id")},t)}function t(b,c){if(!1===c.error){let b=c.meal;a("#yk-mt-add-meal-name").val(b.name),a("#yk-mt-add-meal-description").val(b.description),a("#yk-mt-add-meal-calories").val(b.calories),a("#yk-mt-add-meal-unit").val(b.unit),a("#yk-mt-add-meal-quantity").val(b.quantity),d()}else a("body").trigger("meal-tracker-loading-error")}function u(a,b,c,d,e){var f={id:z("meal-id"),name:a,description:b,calories:c,quantity:d,unit:e,"entry-id":yk_mt_entry_id,"meal-type":yk_mt_selected_meal_type};i("add_meal",f,v)}function v(b,c){!1===c.error?(G(yk_mt_sc_meal_tracker.localise["meal-entry-added-success"]),n(),a("#btn-close-modal").click(),a("body").trigger("meal-tracker-meal-updated")):(a("#btn-close-modal").click(),a("body").trigger("meal-tracker-save-error"))}function w(b,c){!1===c.error?(G(yk_mt_sc_meal_tracker.localise["settings-saved-success"]),setTimeout(function(){window.location.replace(yk_mt["page-url"])},600)):a("body").trigger("meal-tracker-save-error")}function x(){"own"===a("#yk-mt-calorie-source").val()?(a("#yk-mt-allowed-calories").prop("required",!0),a("#yk-mt-allowed-calories-row").show(200)):(a("#yk-mt-allowed-calories").prop("required",!1),a("#yk-mt-allowed-calories-row").hide(200))}function y(b,c){a("#yk-mt-shortcode-meal-tracker").attr("yk-mt-"+b,c)}function z(b){return a("#yk-mt-shortcode-meal-tracker").attr("yk-mt-"+b)}function A(b){return-1!==a.inArray(b,yk_mt["units-hide-quantity"])}function B(b,c,d){let e=yk_mt_sc_meal_tracker.localise["no-data"]+".";0!==c.length&&(html_meals=c.map(J).join(""),d=[{total:d,unit:yk_mt_sc_meal_tracker.localise["calorie-unit"]}],html_total=d.map(K).join(""),e=html_meals+html_total),a("#meals-table-"+b).html(e)}function C(b){"object"!=typeof b||(D(),a.each(b.meals,function(a,c){B(a,c,b.counts[a])}),yk_mt_chart_data_set(b.calories_allowed,b.calories_remaining,b.calories_used,b.percentage_used,b.chart_title),yk_mt_chart_render(),E())}function D(){a.LoadingOverlay("show"),setTimeout(function(){E()},3e3)}function E(){a.LoadingOverlay("hide")}function F(a,b=null){H(a,"error",b)}function G(a,b=null){H(a,"success",b)}function H(b,c="warn",d=null){let e={position:"bottom right",className:c};null===d?a.notify(b,e):a(d).notify(b,e)}if(!0===yk_mt_meal_tracker_found&&(yk_mt_entry_id=yk_mt_sc_meal_tracker["todays-entry"].id),yk_mt_meal_tracker_found&&"true"===yk_mt_sc_meal_tracker["accordion-enabled"]&&(b(),a(".yk-mt__accordion-section .initial-active").each(function(){var b=a(this).attr("href");a(this).addClass("active"),a(".yk-mt__accordion "+b).slideDown(300).addClass("open")}),a(".yk-mt__accordion-section-title").click(function(c){var d=a(this).attr("href");a(c.target).is(".active")?b():(b(),a(this).addClass("active"),a(".yk-mt__accordion "+d).slideDown(300).addClass("open")),c.preventDefault()})),a(".yk-mt-add-meal-prompt").click(function(b){var c=a(b.target).data("meal-type");yk_mt_selected_meal_type=c,a("body").attr("yk-mt-meal-type",c)}),!0===yk_mt_meal_tracker_show){var I=JSON.parse(yk_mt_sc_meal_tracker["dialog-options"]);I.afterClose=function(){c()},I.beforeOpen=function(){h(),e(),a("#yk-mt-add-meal-dialog").removeClass("yk-mt-hide"),r()},yk_meal_tracker_dialog=a(".yk-mt-add-meal-prompt, .yk-mt-edit-meal-prompt").animatedModal(I)}a(".yk-mt-meal-button-add").click(function(b){b.preventDefault();var c=a(this).data("quantity");j(yk_mt_entry_id,a("#yk-mt-meal-id").val(),yk_mt_selected_meal_type,c)}),a("body").on("meal-tracker-save-error",function(){F(yk_mt_sc_meal_tracker.localise["db-error"])}),a("body").on("meal-tracker-loading-error",function(){F(yk_mt_sc_meal_tracker.localise["db-error-loading"])}),a("body").on("meal-tracker-meal-entry-delete",function(a,b){l(b)}),a("#yk-mt-form-add-new-meal").submit(function(b){b.preventDefault();let c=a("#yk-mt-add-meal-name").val(),d=a("#yk-mt-add-meal-description").val(),e=a("#yk-mt-add-meal-calories").val(),f=a("#yk-mt-add-meal-quantity").val(),g=a("#yk-mt-add-meal-unit").val();"edit"===yk_meal_tracker_dialog_mode?u(c,d,e,f,g):p(c,d,e,f,g)}),a("#yk-mt-add-meal-unit").change(function(){r()}),a(".yk-mt-meal-button-edit-inline").live("click",function(b){b.preventDefault();let c=a(this).attr("data-meal-id");y("meal-id",c),s()}),a("#yk-mt-settings-form").submit(function(b){b.preventDefault();let c={};a("#yk-mt-settings-form input[type=number], #yk-mt-settings-form select").each(function(){c[a(this).attr("id")]=a(this).val()}),i("save_settings",c,w)}),a("#yk-mt-calorie-source").change(function(){x()}),x(),a(".yk-mt-clickable").click(function(b){b.preventDefault();let c=a(this).attr("href");window.location.replace(c)});const J=({meal_entry_id:a,meal_type:b,name:c,calories:e,quantity:f,d:g,id:d})=>`
                        <div class="yk-mt__table-row" data-mt="${b}">
                            <div class="yk-mt__table-cell">
                                 ${c}
                            </div>
                            <div class="yk-mt__table-cell yk-mt-cq">
                                ${g}
                            </div>
                            <div class="yk-mt__table-cell yk-mt-o">
                                <button data-meal-id="${id}" class="yk-mt-act-r yk-mt-act-r--edit yk-mt-hide-if-not-pro yk-mt-meal-button-edit-inline" >
                                    <span class="yk-mt-r__text">${yk_mt_sc_meal_tracker[ 'localise' ][ 'edit-text' ]}</span>
                                </button>
                                <button data-id="${meal_entry_id}" class="yk-mt-act-r yk-mt-act-r--remove" onclick="yk_mt_trigger_meal_entry_delete( ${meal_entry_id} )">
                                    <span class="yk-mt-r__text">${yk_mt_sc_meal_tracker[ 'localise' ][ 'remove-text' ]}</span>
                                </button>
                            </div>
                        </div>`,K=({total:a,unit:b})=>`
                        <div class="yk-mt__table-row" >
                                <div class="yk-mt__table-cell">
                                </div>
                                <div class="yk-mt__table-cell yk-mt-cq">
                                    ${a}${b}
                                </div>	
                                <div class="yk-mt__table-cell yk-mt-o">
                                </div>
                        </div>`;!0===yk_mt_meal_tracker_show&&yk_mt_sc_meal_tracker["load-entry"]&&C(yk_mt_sc_meal_tracker["todays-entry"]),a("body").on("meal-tracker-ajax-started",function(){D()}),a("body").on("meal-tracker-ajax-finished",function(){E()})});function yk_mt_trigger_meal_entry_delete(a){jQuery("body").trigger("meal-tracker-meal-entry-delete",[a])}