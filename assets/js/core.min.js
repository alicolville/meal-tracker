var yk_mt_entry_id=0,yk_mt_selected_meal_type=!1,yk_mt_meal_tracker_found="undefined"!=typeof yk_mt_sc_meal_tracker,yk_meal_tracker_dialog=!1,yk_meal_tracker_dialog_mode="add",yk_mt_meal_selector=!1,yk_mt_meal_tracker_show=yk_mt_meal_tracker_found&&"default"===yk_mt_sc_meal_tracker.mode;jQuery(document).ready(function(a){function b(){a(".yk-mt__accordion .yk-mt__accordion-section-title").removeClass("active"),a(".yk-mt__accordion .yk-mt__accordion-section-content").slideUp(300).removeClass("open")}function c(){yk_meal_tracker_dialog_mode="add",a("body").removeClass("yk-mt-dialog-is-open"),a("body").trigger("meal-tracker-dialog-closing"),f(),h(),a("#yk-mt-add-meal-dialog").removeClass("yk-mt-mode-edit"),a("#yk-mt-add-meal-dialog").addClass("yk-mt-mode-add"),a("#yk-mt-form-add-new-meal").trigger("reset"),a(".yk-mt-hide-if-no-meals-results").hide(),a("body").trigger("meal-tracker-dialog-closed")}function d(b="edit"){s(),yk_meal_tracker_dialog_mode=b,"edit"===b&&a("#yk-mt-open-dialog-edit").click()}function e(){a("#yk-mt-add-meal-dialog").removeClass("yk-mt-mode-edit yk-mt-mode-add"),a("#yk-mt-add-meal-dialog").addClass("yk-mt-mode-"+yk_meal_tracker_dialog_mode)}function f(){yk_mt_selected_meal_type=!1}function g(a){if(!1!==yk_mt_meal_selector&&a){var b=yk_mt_meal_selector[0].selectize;b.addOption(a),b.addItem(a.id)}}function h(){if(!1!==yk_mt_meal_selector){var a=yk_mt_meal_selector[0].selectize;a.clear()}}function i(){yk_mt_meal_selector=a("#yk-mt-meal-id").selectize({preload:!0,valueField:"id",labelField:"name",searchField:"name",options:[],load:function(b,c){this.clearOptions(),a.ajax({url:yk_mt["ajax-url"],type:"POST",data:{action:"meals",security:yk_mt["ajax-security-nonce"],search:b},error:function(){c()},success:function(b){!1===b&&(a(".yk-mt-hide-if-no-meals-results").fadeOut("slow"),O(yk_mt_sc_meal_tracker.localise["search-no-results"])),c(b)}})},onChange:function(b){return""===b?void a(".yk-mt-hide-if-no-meals-results").fadeOut("slow"):void a(".yk-mt-hide-if-no-meals-results").fadeIn("slow")}})}function j(b,c,d){c.action=b,c.security=yk_mt["ajax-security-nonce"],a("body").trigger("meal-tracker-ajax-started"),jQuery.post(yk_mt["ajax-url"],c,function(b){d(c,b),a("body").trigger("meal-tracker-ajax-finished")})}function k(a,b,c,d=1){if(b){d||(d=1);var e={"entry-id":a,"meal-id":b,"meal-type":c,quantity:d};j("add_meal_to_entry",e,l)}else N(yk_mt_sc_meal_tracker.localise["meal-entry-missing-meal"],"#yk-mt-form-add-meal-to-entry .selectize-control")}function l(b,c){!1===c.error?(K(c.entry),a("#yk-mt-form-add-meal-to-entry").trigger("reset"),P(yk_mt_sc_meal_tracker.localise["meal-entry-added-success"]),P(yk_mt_sc_meal_tracker.localise["meal-entry-added-short"],"#yk-mt-button-add-meal-"+b.quantity),a("#yk-mt-button-add-meal-close").is(":checked")&&a("#btn-close-modal").click(),a("body").trigger("meal-tracker-meal-added")):(a("#btn-close-modal").click(),a("body").trigger("meal-tracker-save-error"))}function m(a){var b={"meal-entry-id":a,"entry-id":yk_mt_entry_id};j("delete_meal_from_entry",b,n)}function n(b,c){!1===c.error?(K(c.entry),P(yk_mt_sc_meal_tracker.localise["meal-entry-deleted-success"]),a("body").trigger("meal-tracker-meal-deleted")):a("body").trigger("meal-tracker-save-error")}function o(){var a={"entry-id":yk_mt_entry_id};j("get_entry",a,p)}function p(a,b){K(b)}function q(a,b,c,d,e,f){var g={name:a,description:b,calories:c,quantity:d,unit:e,"entry-id":yk_mt_entry_id,"meal-type":yk_mt_selected_meal_type,"meta-fields":f};j("add_meal",g,r)}function r(b,c){!1===c.error?(g(c["new-meal"]),P(yk_mt_sc_meal_tracker.localise["meal-entry-added-short"],"#yk-mt-button-meal-add"),a("#yk-mt-form-add-new-meal").trigger("reset"),P(yk_mt_sc_meal_tracker.localise["meal-entry-added-success"]),o(),a("#btn-close-modal").click(),a("body").trigger("meal-tracker-new-meal-added")):a("body").trigger("meal-tracker-save-error")}function s(){let b=a("#yk-mt-add-meal-unit").val(),c=a("#yk-mt-add-meal-quantity-row");!0===I(b)?(a("#yk-mt-add-meal-quantity").prop("disabled",!0),a("#yk-mt-add-meal-quantity").prop("required",!1),a("#yk-mt-add-meal-quantity").val(""),c.hide()):(a("#yk-mt-add-meal-quantity").prop("disabled",!1),a("#yk-mt-add-meal-quantity").prop("required",!0),c.show())}function t(){j("meal",{"meal-id":H("meal-id")},u)}function u(b,c){if(!1===c.error){let b=c.meal;a("#yk-mt-add-meal-name").val(b.name),a("#yk-mt-add-meal-description").val(b.description),a("#yk-mt-add-meal-calories").val(b.calories),a("#yk-mt-add-meal-unit").val(b.unit),a("#yk-mt-add-meal-quantity").val(b.quantity);let e=F();!1!==e&&a.each(e,function(c){a("#yk-mt-add-meal-"+c).val(b[c])}),x("manual"),d()}else a("body").trigger("meal-tracker-loading-error")}function v(a,b,c,d,e,f){var g={id:H("meal-id"),name:a,description:b,calories:c,quantity:d,unit:e,"entry-id":yk_mt_entry_id,"meal-type":yk_mt_selected_meal_type,"meta-fields":f};j("add_meal",g,w)}function w(b,c){!1===c.error?(P(yk_mt_sc_meal_tracker.localise["meal-entry-added-success"]),o(),a("#btn-close-modal").click(),a("body").trigger("meal-tracker-meal-updated")):(a("#btn-close-modal").click(),a("body").trigger("meal-tracker-save-error"))}function x(b){"manual"===b?(a("#yk-mt-form-add-new-meal-nav").hide(),a(".yk-mt__modal-quick-search").hide(),a(".yk-mt-add-new-meal-form").fadeIn("slow")):"search"===b?(a("#yk-mt-form-add-new-meal-nav").hide(),a(".yk-mt__modal-quick-search").hide(),a(".yk-mt-add-new-meal-form-search-external").fadeIn("slow"),z()):y()}function y(){a(".yk-mt-add-new-meal-form").hide(),a(".yk-mt-add-new-meal-form-search-external").hide(),a("#yk-mt-form-add-new-meal-nav").fadeIn("slow"),a(".yk-mt__modal-quick-search").fadeIn("slow")}function z(){a("#yk-mt-search-external").selectize({preload:!1,valueField:"id",labelField:"name",searchField:"name",options:[],render:{option:function(a,b){let c="<div class=\"external_list_item\">";return c+="<h6>",a.ext_image&&(c=c+"<img src=\""+b(a.ext_image)+"\" width=\"96\" align=\"left\"/>"),c=c+b(a.name)+"</h6>",c=c+"<p class=\"description\">"+b(a.description)+"</p>",c=c+"<p class=\"nutrition\">"+b(a.nutrition)+"</p>",c+="<div>",c}},load:function(b,c){""==b||(this.clearOptions(),a.ajax({url:yk_mt["ajax-url"],type:"POST",data:{action:"external_search",security:yk_mt["ajax-security-nonce"],search:b},error:function(){c()},success:function(b){"error"==b?(N(yk_mt_sc_meal_tracker.localise["search-error"]),A()):!1===b||0==b?(O(yk_mt_sc_meal_tracker.localise["search-no-results"]),A(),a(".yk-mt-add-new-meal-form-search-servings").fadeOut("slow")):!1===yk_mt_external_servings_enabled()&&a(".yk-mt-button-external-add-and-close, .yk-mt-button-external-add").fadeIn("slow"),c(b)}}))},onChange:function(b){!1===yk_mt_external_servings_enabled()||(""===b?(a(".yk-mt-add-new-meal-form-search-servings").fadeOut("slow"),A()):B(b))}})}function A(){a(".yk-mt-button-external-add-and-close, .yk-mt-button-external-add").fadeOut("slow")}function B(b){a(".yk-mt-add-new-meal-form-search-servings").fadeIn("slow"),!1!==S&&a("#yk-mt-search-external-servings").selectize()[0].selectize.destroy(),S=a("#yk-mt-search-external-servings").selectize({preload:!0,create:!1,valueField:"serving_id",labelField:"display",options:[],load:function(c,d){""==b||(this.clearOptions(),a.ajax({url:yk_mt["ajax-url"],type:"POST",data:{action:"external_servings",security:yk_mt["ajax-security-nonce"],search:b},error:function(){d()},success:function(b){"error"==b?(N(yk_mt_sc_meal_tracker.localise["search-error"]),A()):!1===b||0==b?(O(yk_mt_sc_meal_tracker.localise["search-no-results"]),A()):a(".yk-mt-button-external-add-and-close, .yk-mt-button-external-add").fadeIn("slow"),d(b)}}))},onChange:function(b){""!==b&&!0===yk_mt_external_servings_enabled()&&a(".yk-mt-button-external-add-and-close, .yk-mt-button-external-add").fadeIn("slow")}})}function C(a,b){if(!1===b.error){P(yk_mt_sc_meal_tracker.localise["search-added"]);let c={id:b.meal_id,name:a.name};g(c),!0===a.close&&y()}else N(yk_mt_sc_meal_tracker.localise["db-error"])}function D(b,c){!1===c.error?(P(yk_mt_sc_meal_tracker.localise["settings-saved-success"]),setTimeout(function(){window.location.replace(yk_mt["page-url"])},600)):a("body").trigger("meal-tracker-save-error")}function E(){"own"===a("#yk-mt-calorie-source").val()?(a("#yk-mt-allowed-calories").prop("required",!0),a("#yk-mt-allowed-calories-row").show(200)):(a("#yk-mt-allowed-calories").prop("required",!1),a("#yk-mt-allowed-calories-row").hide(200))}function F(){return!1!==yk_mt_meal_tracker_found&&"undefined"!=typeof yk_mt_sc_meal_tracker["meta-fields"]&&yk_mt_sc_meal_tracker["meta-fields"]}function G(b,c){a("#yk-mt-shortcode-meal-tracker").attr("yk-mt-"+b,c)}function H(b){return a("#yk-mt-shortcode-meal-tracker").attr("yk-mt-"+b)}function I(b){return-1!==a.inArray(b,yk_mt["units-hide-quantity"])}function J(b,c,d,e){let f="<p class=\"yk-mt__no-meals\">"+yk_mt_sc_meal_tracker.localise["no-data"]+".</p>";0!==c.length&&(html_meals=c.map(T).join(""),d=[{total:d,unit:yk_mt_sc_meal_tracker.localise["calorie-unit"],meta_totals:e}],html_total=d.map(U).join(""),f=html_meals+html_total),a("#meals-table-"+b).html(f)}function K(b,c=!1){"object"!=typeof b||(L(),!1===c&&a.each(b.meals,function(a,c){J(a,c,b.counts[a],b.meta_counts[a].summary)}),yk_mt_chart_data_set(b.calories_allowed,b.calories_remaining,b.calories_used,b.percentage_used,b.chart_title),yk_mt_chart_render(),M())}function L(){a.LoadingOverlay("show"),setTimeout(function(){M()},3e3)}function M(){a.LoadingOverlay("hide")}function N(a,b=null){Q(a,"error",b)}function O(a,b=null){Q(a,"info",b)}function P(a,b=null){Q(a,"success",b)}function Q(b,c="warn",d=null){let e={position:"bottom right",className:c};null===d?a.notify(b,e):a(d).notify(b,e)}if(!0===yk_mt_meal_tracker_found&&(yk_mt_entry_id=yk_mt_sc_meal_tracker["todays-entry"].id),yk_mt_meal_tracker_found&&"true"===yk_mt_sc_meal_tracker["accordion-enabled"]&&(b(),a(".yk-mt__accordion-section .initial-active").each(function(){var b=a(this).attr("href");a(this).addClass("active"),a(".yk-mt__accordion "+b).slideDown(300).addClass("open")}),a(".yk-mt__accordion-section-title").click(function(c){var d=a(this).attr("href");a(c.target).is(".active")?b():(b(),a(this).addClass("active"),a(".yk-mt__accordion "+d).slideDown(300).addClass("open")),c.preventDefault()})),a(".yk-mt-add-meal-prompt").click(function(b){let c=a(b.target).data("meal-type");yk_mt_selected_meal_type=c,a("body").attr("yk-mt-meal-type",c)}),!0===yk_mt_meal_tracker_show){var R=JSON.parse(yk_mt_sc_meal_tracker["dialog-options"]);R.afterClose=function(){c()},R.beforeOpen=function(){i(),e(),a("body").addClass("yk-mt-dialog-is-open"),a("#yk-mt-add-meal-dialog").removeClass("yk-mt-hide"),s()},yk_meal_tracker_dialog=a(".yk-mt-add-meal-prompt, .yk-mt-edit-meal-prompt").animatedModal(R)}a(".yk-mt-meal-button-add").click(function(b){b.preventDefault();var c=a(this).data("quantity");k(yk_mt_entry_id,a("#yk-mt-meal-id").val(),yk_mt_selected_meal_type,c)}),a("body").on("meal-tracker-save-error",function(){N(yk_mt_sc_meal_tracker.localise["db-error"])}),a("body").on("meal-tracker-loading-error",function(){N(yk_mt_sc_meal_tracker.localise["db-error-loading"])}),a("body").on("meal-tracker-meal-entry-delete",function(a,b){m(b)}),a("#yk-mt-form-add-new-meal").submit(function(b){b.preventDefault();let c=a("#yk-mt-add-meal-name").val(),d=a("#yk-mt-add-meal-description").val(),e=a("#yk-mt-add-meal-calories").val(),f=a("#yk-mt-add-meal-quantity").val(),g=a("#yk-mt-add-meal-unit").val(),h=F();yk_mt_meal_tracker_found&&!1!==h&&a.each(h,function(b){h[b]=a("#yk-mt-add-meal-"+b).val()}),"edit"===yk_meal_tracker_dialog_mode?v(c,d,e,f,g,h):q(c,d,e,f,g,h)}),a("#yk-mt-add-meal-unit").change(function(){s()}),a("body").on("click",".yk-mt-meal-button-edit-inline",function(b){b.preventDefault();let c=a(this).attr("data-meal-id");G("meal-id",c),t()}),a("body").on("meal-tracker-dialog-closing",function(){y()}),a("#yk-mt-button-meal-nav-manually-add").click(function(a){a.preventDefault(),x("manual")}),a("#yk-mt-button-meal-nav-search").click(function(a){a.preventDefault(),x("search")}),a(".yk-mt-button-reset-meal-nav").click(function(a){a.preventDefault(),y()});let S=!1;a(".yk-mt-button-external-add").click(function(b){b.preventDefault();let c=a("#yk-mt-search-external")[0].selectize,d=c.getValue(),e=c.getItem(c.getValue())[0].innerHTML;if(""===d)return;if(!1!==S){let b=a("#yk-mt-search-external-servings").selectize()[0].selectize,c=b.getValue();""!==c&&(e+=" - "+b.getItem(b.getValue())[0].innerHTML)}let f="yk-mt-button-external-meal-add-close"===a(this).attr("id"),g={meal_id:d,name:e,close:f};if(!0===yk_mt_external_servings_enabled()){let b=a("#yk-mt-search-external-servings")[0].selectize,c=b.getValue();if(""===c)return void N(yk_mt_sc_meal_tracker.localise["serving-missing"]);g.serving_id=c}j("external_add_to_collection",g,C)}),a("#yk-mt-settings-form").submit(function(b){b.preventDefault();let c={};a("#yk-mt-settings-form input[type=number], #yk-mt-settings-form select").each(function(){c[a(this).attr("id")]=a(this).val()}),j("save_settings",c,D)}),a("#yk-mt-calorie-source").change(function(){E()}),E(),a(".yk-mt-clickable").click(function(b){b.preventDefault();let c=a(this).attr("href");window.location.replace(c)});const T=({meal_entry_id:a,meal_type:b,name:c,calories:e,quantity:f,d:g,id:d,css_class:h})=>`
                        <div class="yk-mt__table-row" data-mt="${b}">
                            <div class="yk-mt__table-cell yk-mt__table-cell-meal">
                                <span class="yk-mt__meal-name">${c}</span>
                            </div>
                            <div class="yk-mt__table-cell yk-mt__table-cell-quantity yk-mt-cq">
                                <span class="yk-mt__meal-data">${g}</span>
                            </div>
                            <div class="yk-mt__table-cell yk-mt__table-cell-controls yk-mt-o">
                                <div class="yk-mt__btn-group yk-mt-inline-flex">
                                    <button data-meal-id="${d}" class="yk-mt-act-r yk-mt-act-r--edit yk-mt-hide-if-not-pro yk-mt-meal-button-edit-inline ${h}" >
                                        <span class="fa fa-edit"></span>
                                        <span class="yk-mt-r__text">${yk_mt_sc_meal_tracker.localise["edit-text"]}</span>
                                    </button>
                                    <button data-id="${a}" class="yk-mt-act-r yk-mt-act-r--remove" onclick="yk_mt_trigger_meal_entry_delete( ${a} )">
                                        <span class="fa fa-close"></span>
                                        <span class="yk-mt-r__text">${yk_mt_sc_meal_tracker.localise["remove-text"]}</span>
                                    </button>
                                </div>
                            </div>
                        </div>`,U=({total:a,unit:b,meta_totals:c})=>`
                        <div class="yk-mt__table-row yk-mt__table-row-totals">
                                <div class="yk-mt__table-cell yk-mt__table-cell-total-text">${yk_mt_sc_meal_tracker.localise.total}:</div>
                                <div class="yk-mt__table-cell yk-mt__table-cell-total yk-mt-cq">
                                    ${a}${b}
                                    <span class="yk-mt-meta-totals yk-mt-hide-if-meta-disabled">
                                      ${c}
                                    </span>
                                </div>
                                <div class="yk-mt__table-cell yk-mt-o">
                                </div>
                        </div>`;!0===yk_mt_meal_tracker_show&&yk_mt_sc_meal_tracker["load-entry"]&&K(yk_mt_sc_meal_tracker["todays-entry"]),a("body").on("meal-tracker-ajax-started",function(){L()}),a("body").on("meal-tracker-ajax-finished",function(){M()})});function yk_mt_trigger_meal_entry_delete(a){jQuery("body").trigger("meal-tracker-meal-entry-delete",[a])}function yk_mt_external_servings_enabled(){return"undefined"!=typeof yk_mt["external-show-servings"]&&"1"===yk_mt["external-show-servings"]}
